<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/Prx.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/Prx.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import axios from "axios"
import {v4} from "uuid"
import Helper from "./Helper"

/**
 * PrxCache
 * ProxyHttp with local cache
 * */
class PrxCache {
	age = 0
	result = null
	key = null
	maxAge = 9000
	birth = null
	data = null
	reqCount = 0
	constructor(key){
		this.birth = new Date
		this.key = key
	}

	setResult(result){
		this.reqCount = 0

		this.birth = new Date

		// console.log(result)
		this.result = result
		this.data = JSON.stringify(result.data)
	}

	calculateAge(){
		// this.birth = new Date
		const currentDate = new Date
		this.age = currentDate - this.birth
	}

	getResult(){
		if(this.result){
			// this.reqCount = 0;
			this.result.data = JSON.parse(this.data)
		}
		return this.result
	}

	getAge(){
		return this.age
	}

	hit(){
		this.calculateAge()
		return this.age &lt; this.maxAge
	}

	validate(){
		if(this.reqCount > 0){
			return true
		}
		let validResult = typeof this.result == 'object'
		const hit = this.hit()
		try{
			validResult = this.result.status == 200
		}catch(e){
			validResult = false
		}

		return validResult  &amp;&amp; hit
	}

	resetOnRequest(){
		this.reqCount = 0
		this.calculateAge()
	}
	setOnRequest(){
		this.reqCount += 1
		const delay = Helper.makeDelay(this.maxAge)
		delay(()=>{
			this.resetOnRequest()
		})
	}
}
/**
 * Prx
 * Axios capsules with Caching support
 * */
class Prx {
	static caches = {}
	static async request(options){

	}
	/**
	 * perform http get
	 * */
	static async get(url){
		const key = Helper.underscore(url);
		// console.log(key)
		if(typeof Prx.caches[key] != 'object'){
			Prx.caches[key] = new PrxCache(key);
		}

		if(Prx.caches[key].validate()){
			// console.log(`Cached ${Prx.caches[key].age}`)
			const res =  Prx.caches[key].getResult()
			// console.log(res)
			return res
		}
		Prx.caches[key].setOnRequest()
		const res = await axios.get(url)
		
		Prx.caches[key].setResult(res);

		return res
	}
	/**
	 * perform http post
	 * */
	static async post(url, data){
		const formData = new FormData();
		for(let key in data){
			const value = data[key]
			formData.append(key, value)
		}
		const res = await axios({
			method: "post",
			url,
			data: formData,
			headers: { "Content-Type": "multipart/form-data" },
		});
	}
}

export default Prx </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Action_se.html">Action_se</a></li><li><a href="Action_sei.html">Action_sei</a></li><li><a href="AppConfig.html">AppConfig</a></li><li><a href="ContentEditor.html">ContentEditor</a></li><li><a href="ContentTtfEditor.html">ContentTtfEditor</a></li><li><a href="Helper.html">Helper</a></li><li><a href="LsConfig.html">LsConfig</a></li><li><a href="Prx.html">Prx</a></li><li><a href="PrxCache.html">PrxCache</a></li><li><a href="PrxStore.html">PrxStore</a></li><li><a href="SelectSpeaker.html">SelectSpeaker</a></li><li><a href="SentenceEditorTab.html">SentenceEditorTab</a></li><li><a href="SentenceItem.html">SentenceItem</a></li><li><a href="SentenceItemEditor.html">SentenceItemEditor</a></li><li><a href="State_se.html">State_se</a></li><li><a href="Store_se.html">Store_se</a></li><li><a href="TaskQueueToolbar.html">TaskQueueToolbar</a></li><li><a href="Task_sei.html">Task_sei</a></li><li><a href="TextItem.html">TextItem</a></li><li><a href="TitleEditor.html">TitleEditor</a></li><li><a href="Toolbar_ti.html">Toolbar_ti</a></li><li><a href="Toolbar_ttf.html">Toolbar_ttf</a></li><li><a href="TtfItem.html">TtfItem</a></li><li><a href="UiConfig.html">UiConfig</a></li><li><a href="UiItem.html">UiItem</a></li><li><a href="Ui_se.html">Ui_se</a></li><li><a href="Ws.html">Ws</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Apr 04 2023 16:14:16 GMT+0700 (Western Indonesia Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
